<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>./?Vanilla JS Google Maps Loader</title>
</head>
<body>
  <h2>Google Maps API Loader (Vanilla JS)</h2>
  <div id="status">Loading...</div>

  <script>
    async function loadGoogleMapsAPI({ key, version = "weekly", libraries = [] }) {
      return new Promise((resolve, reject) => {
        if (window.google && window.google.maps) {
          resolve(window.google.maps);
          return;
        }

        const script = document.createElement("script");
        const params = new URLSearchParams({
          key,
          v: version,
          libraries: libraries.join(","),
          callback: "initGoogleMaps"
        });

        script.src = `https://maps.googleapis.com/maps/api/js?${params.toString()}`;
        script.async = true;
        script.defer = true;

        window.initGoogleMaps = () => {
          resolve(window.google.maps);
        };

        script.onerror = () => {
          reject(new Error("Failed to load Google Maps JavaScript API"));
        };

        document.head.appendChild(script);
      });
    }

    // Example usage
    (async () => {
      try {
        const maps = await loadGoogleMapsAPI({
          key: "AIzaSyAMSVAezvWlrflZTMTozGTKzYyrzfFKV0A",
          version: "weekly",
          libraries: ["places"]
        });

        document.getElementById("status").textContent = "✅ Google Maps API loaded!";
        console.log("Google Maps API is ready:", maps);
      } catch (err) {
        document.getElementById("status").textContent = "❌ Failed to load Maps API";
        console.error(err);
      }
    })();

        async function initMap() {
            // Request needed libraries.
                await google.maps.importLibrary("places");
            // Create the input HTML element, and append it.
            //@ts-ignore
                const placeAutocomplete = new google.maps.places.PlaceAutocompleteElement();
            //@ts-ignore
                document.body.appendChild(placeAutocomplete);
            // Inject HTML UI.
                const selectedPlaceTitle = document.createElement('p');
                selectedPlaceTitle.textContent = '';
                document.body.appendChild(selectedPlaceTitle);
                const selectedPlaceInfo = document.createElement('pre');
                selectedPlaceInfo.textContent = '';
                document.body.appendChild(selectedPlaceInfo);
            // Add the gmp-placeselect listener, and display the results.
            //@ts-ignore
            placeAutocomplete.addEventListener('gmp-select', async ({ placePrediction }) => {
                const place = placePrediction.toPlace();
                await place.fetchFields({ fields: ['displayName', 'formattedAddress', 'location'] });
                selectedPlaceTitle.textContent = 'Selected Place:';
                selectedPlaceInfo.textContent = JSON.stringify(place.toJSON(), /* replacer */ null, /* space */ 2);
            });
        }
        initMap();        

  </script>
</body>
</html>